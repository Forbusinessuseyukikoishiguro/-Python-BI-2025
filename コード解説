# =============================================================================
# Pythonãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼š1è¡Œãšã¤è©³ç´°è§£èª¬
# æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ã‚¬ã‚¤ãƒ‰
# =============================================================================

# ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€‘
import pandas as pd              # ãƒ‡ãƒ¼ã‚¿æ“ä½œã®ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆDataFrameã‚’æ‰±ã†ãŸã‚ï¼‰
import numpy as np              # æ•°å€¤è¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆæ•°å­¦çš„æ“ä½œã‚„NaNå‡¦ç†ã«ä½¿ç”¨ï¼‰
import warnings                 # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ¶å¾¡ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
warnings.filterwarnings('ignore')  # ä¸è¦ãªè­¦å‘Šã‚’éè¡¨ç¤ºã«ã™ã‚‹ï¼ˆä½œæ¥­åŠ¹ç‡å‘ä¸Šã®ãŸã‚ï¼‰

# ã€ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã€‘
# CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§DataFrameã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ ¼ç´
df = pd.read_csv('sample_data.csv')  # ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦CSVã‚’èª­ã¿è¾¼ã¿

# ã€åŸºæœ¬æƒ…å ±ã®ç¢ºèªã€‘
print("=" * 50)              # åŒºåˆ‡ã‚Šç·šã‚’å‡ºåŠ›ï¼ˆè¦–èªæ€§å‘ä¸Šã®ãŸã‚ï¼‰
print("ãƒ‡ãƒ¼ã‚¿ã®åŸºæœ¬æƒ…å ±")        # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‡ºåŠ›
print("=" * 50)              # åŒºåˆ‡ã‚Šç·šã‚’å‡ºåŠ›

print(f"ãƒ‡ãƒ¼ã‚¿ã®å½¢çŠ¶: {df.shape}")    # (è¡Œæ•°, åˆ—æ•°)ã‚’è¡¨ç¤º
print(f"åˆ—å: {list(df.columns)}")   # å…¨ã¦ã®åˆ—åã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¡¨ç¤º
print("\n")                          # æ”¹è¡Œã‚’è¿½åŠ ï¼ˆèª­ã¿ã‚„ã™ã•ã®ãŸã‚ï¼‰

# ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªï¼ˆæ–‡å­—åˆ—ã€æ•°å€¤ã€æ—¥ä»˜ãªã©ã®å‹ã‚’æŠŠæ¡ï¼‰
print("å„åˆ—ã®ãƒ‡ãƒ¼ã‚¿å‹:")
print(df.dtypes)                     # å„åˆ—ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ä¸€è¦§è¡¨ç¤º
print("\n")

# æœ€åˆã®5è¡Œã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’ç¢ºèªï¼‰
print("ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®5è¡Œ:")
print(df.head())                     # head()ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã‚’ç¢ºèª
print("\n")

# æ¬ æå€¤ã®çŠ¶æ³ã‚’ç¢ºèª
print("æ¬ æå€¤ã®ç¢ºèª:")
missing_info = df.isnull().sum()     # å„åˆ—ã®æ¬ æå€¤æ•°ã‚’è¨ˆç®—
print(missing_info)                  # æ¬ æå€¤æ•°ã‚’è¡¨ç¤º
print(f"å…¨ä½“ã®æ¬ æå€¤æ•°: {missing_info.sum()}")  # å…¨ã¦ã®æ¬ æå€¤ã®åˆè¨ˆ
print("\n")

# é‡è¤‡è¡Œã®ç¢ºèª
duplicate_count = df.duplicated().sum()  # é‡è¤‡è¡Œã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
print(f"é‡è¤‡è¡Œæ•°: {duplicate_count}")      # é‡è¤‡è¡Œæ•°ã‚’è¡¨ç¤º
print("\n")

# =============================================================================
# ã€STEP 1: åˆ—åã®æ¨™æº–åŒ–ã€‘
# =============================================================================

print("STEP 1: åˆ—åã®æ¨™æº–åŒ–")
print("-" * 30)

# å…ƒã®åˆ—åã‚’ä¿å­˜ï¼ˆå¾Œã§æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ï¼‰
original_columns = df.columns.tolist()  # å…ƒã®åˆ—åã‚’ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜

# åˆ—åã‚’å°æ–‡å­—ã«å¤‰æ›
df.columns = df.columns.str.lower()     # str.lower()ã§å…¨ã¦å°æ–‡å­—ã«å¤‰æ›

# ç©ºç™½ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«ç½®æ›
df.columns = df.columns.str.replace(' ', '_')  # ã‚¹ãƒšãƒ¼ã‚¹ã‚’_ã«ç½®æ›

# ç‰¹æ®Šæ–‡å­—ã‚’é™¤å»ï¼ˆè‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ä»¥å¤–ã‚’å‰Šé™¤ï¼‰
df.columns = df.columns.str.replace('[^a-zA-Z0-9_]', '', regex=True)

print("åˆ—åã®å¤‰æ›´:")
for old, new in zip(original_columns, df.columns):  # å…ƒã®åå‰ã¨æ–°ã—ã„åå‰ã‚’ãƒšã‚¢ã§è¡¨ç¤º
    if old != new:                      # å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿è¡¨ç¤º
        print(f"  {old} â†’ {new}")       # å¤‰æ›´å†…å®¹ã‚’è¡¨ç¤º
print("\n")

# =============================================================================
# ã€STEP 2: é‡è¤‡è¡Œã®å‰Šé™¤ã€‘
# =============================================================================

print("STEP 2: é‡è¤‡è¡Œã®å‰Šé™¤")
print("-" * 30)

initial_rows = len(df)                  # å‰Šé™¤å‰ã®è¡Œæ•°ã‚’è¨˜éŒ²
df = df.drop_duplicates()               # é‡è¤‡è¡Œã‚’å‰Šé™¤ï¼ˆå®Œå…¨ã«åŒã˜è¡Œã‚’å‰Šé™¤ï¼‰
final_rows = len(df)                    # å‰Šé™¤å¾Œã®è¡Œæ•°ã‚’è¨˜éŒ²
removed_rows = initial_rows - final_rows # å‰Šé™¤ã•ã‚ŒãŸè¡Œæ•°ã‚’è¨ˆç®—

print(f"å‰Šé™¤å‰: {initial_rows}è¡Œ")       # å‰Šé™¤å‰ã®è¡Œæ•°ã‚’è¡¨ç¤º
print(f"å‰Šé™¤å¾Œ: {final_rows}è¡Œ")         # å‰Šé™¤å¾Œã®è¡Œæ•°ã‚’è¡¨ç¤º
print(f"å‰Šé™¤ã•ã‚ŒãŸè¡Œæ•°: {removed_rows}è¡Œ") # å‰Šé™¤ã•ã‚ŒãŸè¡Œæ•°ã‚’è¡¨ç¤º
print("\n")

# =============================================================================
# ã€STEP 3: ãƒ‡ãƒ¼ã‚¿å‹ã®å¤‰æ›ã€‘
# =============================================================================

print("STEP 3: ãƒ‡ãƒ¼ã‚¿å‹ã®å¤‰æ›")
print("-" * 30)

# æ—¥ä»˜åˆ—ã®è‡ªå‹•æ¤œå‡ºã¨å¤‰æ›
for column in df.columns:               # å…¨ã¦ã®åˆ—ã‚’é †ç•ªã«ç¢ºèª
    # åˆ—åã«'date'ã¾ãŸã¯'time'ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
    if 'date' in column or 'time' in column:
        try:                            # ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§try-exceptæ–‡ã‚’ä½¿ç”¨
            # æ—¥ä»˜å‹ã«å¤‰æ›ã‚’è©¦è¡Œ
            df[column] = pd.to_datetime(df[column])
            print(f"âœ… {column}ã‚’æ—¥ä»˜å‹ã«å¤‰æ›ã—ã¾ã—ãŸ")
        except ValueError as e:         # å¤‰æ›ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ
            print(f"âŒ {column}ã®æ—¥ä»˜å¤‰æ›ã«å¤±æ•—: {e}")
        except Exception as e:          # ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ
            print(f"âŒ {column}ã§äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")

# æ•°å€¤åˆ—ã®å¤‰æ›ï¼ˆæ–‡å­—åˆ—ã¨ã—ã¦èª­ã¿è¾¼ã¾ã‚ŒãŸæ•°å€¤ã‚’å¤‰æ›ï¼‰
for column in df.select_dtypes(include=['object']).columns:  # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ï¼ˆæ–‡å­—åˆ—ï¼‰ã®åˆ—ã®ã¿å¯¾è±¡
    try:
        # æ–‡å­—åˆ—ã‚’ä¸€åº¦stringã«å¤‰æ›ã—ã¦ã‹ã‚‰æ•°å€¤å¤‰æ›å‰ã®å‰å‡¦ç†
        cleaned_series = df[column].astype(str)  # ç¢ºå®Ÿã«æ–‡å­—åˆ—å‹ã«ã™ã‚‹
        
        # ã‚«ãƒ³ãƒã€å††ãƒãƒ¼ã‚¯ã€ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã‚’é™¤å»
        cleaned_series = cleaned_series.str.replace(',', '')     # ã‚«ãƒ³ãƒã‚’é™¤å»
        cleaned_series = cleaned_series.str.replace('Â¥', '')     # å††ãƒãƒ¼ã‚¯ã‚’é™¤å»
        cleaned_series = cleaned_series.str.replace('$', '')     # ãƒ‰ãƒ«ãƒãƒ¼ã‚¯ã‚’é™¤å»
        cleaned_series = cleaned_series.str.replace(' ', '')     # ç©ºç™½ã‚’é™¤å»
        
        # æ•°å€¤å‹ã«å¤‰æ›ã‚’è©¦è¡Œ
        df[column] = pd.to_numeric(cleaned_series, errors='coerce')  # errors='coerce'ã§å¤‰æ›å¤±æ•—æ™‚ã¯NaN
        
        # NaNã§ãªã„å€¤ãŒå­˜åœ¨ã™ã‚Œã°å¤‰æ›æˆåŠŸã¨ã¿ãªã™
        if not df[column].isna().all():  # å…¨ã¦ãŒNaNã§ãªã„å ´åˆ
            print(f"âœ… {column}ã‚’æ•°å€¤å‹ã«å¤‰æ›ã—ã¾ã—ãŸ")
        else:                           # å…¨ã¦ãŒNaNã®å ´åˆã¯å…ƒã«æˆ»ã™
            df[column] = df[column].astype(str)  # å…ƒã®æ–‡å­—åˆ—å‹ã«æˆ»ã™
            
    except Exception as e:              # å¤‰æ›ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
        print(f"â„¹ï¸ {column}ã¯æ–‡å­—åˆ—ã®ã¾ã¾ä¿æŒã—ã¾ã™")
        continue                        # æ¬¡ã®åˆ—ã®å‡¦ç†ã«ç¶šè¡Œ

print("\n")

# =============================================================================
# ã€STEP 4: æ¬ æå€¤ã®å‡¦ç†ã€‘
# =============================================================================

print("STEP 4: æ¬ æå€¤ã®å‡¦ç†")
print("-" * 30)

# å‡¦ç†å‰ã®æ¬ æå€¤æ•°ã‚’è¨˜éŒ²
missing_before = df.isnull().sum().sum()  # å…¨ä½“ã®æ¬ æå€¤æ•°ã‚’è¨ˆç®—

# æ•°å€¤åˆ—ã®æ¬ æå€¤ã‚’å¹³å‡å€¤ã§è£œå®Œ
numeric_columns = df.select_dtypes(include=[np.number]).columns  # æ•°å€¤å‹ã®åˆ—ã‚’å–å¾—
for column in numeric_columns:          # æ•°å€¤åˆ—ã‚’é †ç•ªã«å‡¦ç†
    if df[column].isnull().sum() > 0:   # æ¬ æå€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿å‡¦ç†
        mean_value = df[column].mean()  # å¹³å‡å€¤ã‚’è¨ˆç®—
        df[column].fillna(mean_value, inplace=True)  # å¹³å‡å€¤ã§æ¬ æå€¤ã‚’è£œå®Œ
        print(f"âœ… {column}: å¹³å‡å€¤ {mean_value:.2f} ã§è£œå®Œ")

# ã‚«ãƒ†ã‚´ãƒªåˆ—ï¼ˆæ–‡å­—åˆ—åˆ—ï¼‰ã®æ¬ æå€¤ã‚’æœ€é »å€¤ã§è£œå®Œ
categorical_columns = df.select_dtypes(include=['object', 'category']).columns  # æ–‡å­—åˆ—/ã‚«ãƒ†ã‚´ãƒªå‹ã®åˆ—
for column in categorical_columns:      # ã‚«ãƒ†ã‚´ãƒªåˆ—ã‚’é †ç•ªã«å‡¦ç†
    if df[column].isnull().sum() > 0:   # æ¬ æå€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿å‡¦ç†
        mode_values = df[column].mode() # æœ€é »å€¤ã‚’å–å¾—ï¼ˆè¤‡æ•°ã‚ã‚‹å ´åˆã‚‚ã‚ã‚‹ï¼‰
        if len(mode_values) > 0:        # æœ€é »å€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
            fill_value = mode_values[0] # æœ€åˆã®æœ€é »å€¤ã‚’ä½¿ç”¨
            df[column].fillna(fill_value, inplace=True)  # æœ€é »å€¤ã§è£œå®Œ
            print(f"âœ… {column}: æœ€é »å€¤ '{fill_value}' ã§è£œå®Œ")
        else:                           # æœ€é »å€¤ãŒå–å¾—ã§ããªã„å ´åˆ
            df[column].fillna('Unknown', inplace=True)   # 'Unknown'ã§è£œå®Œ
            print(f"âœ… {column}: 'Unknown' ã§è£œå®Œ")

# æ—¥ä»˜åˆ—ã®æ¬ æå€¤å‡¦ç†
datetime_columns = df.select_dtypes(include=['datetime64[ns]']).columns  # æ—¥ä»˜å‹ã®åˆ—
for column in datetime_columns:         # æ—¥ä»˜åˆ—ã‚’é †ç•ªã«å‡¦ç†
    if df[column].isnull().sum() > 0:   # æ¬ æå€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
        # å‰ã®å€¤ã§è£œå®Œï¼ˆforward fillï¼‰
        df[column].fillna(method='ffill', inplace=True)
        # ã¾ã æ¬ æå€¤ãŒã‚ã‚‹å ´åˆã¯å¾Œã®å€¤ã§è£œå®Œï¼ˆbackward fillï¼‰
        df[column].fillna(method='bfill', inplace=True)
        print(f"âœ… {column}: å‰å¾Œã®å€¤ã§è£œå®Œ")

# å‡¦ç†å¾Œã®æ¬ æå€¤æ•°ã‚’ç¢ºèª
missing_after = df.isnull().sum().sum()   # å‡¦ç†å¾Œã®æ¬ æå€¤æ•°
print(f"\næ¬ æå€¤å‡¦ç†çµæœ:")
print(f"  å‡¦ç†å‰: {missing_before}å€‹")    # å‡¦ç†å‰ã®æ¬ æå€¤æ•°
print(f"  å‡¦ç†å¾Œ: {missing_after}å€‹")     # å‡¦ç†å¾Œã®æ¬ æå€¤æ•°
print(f"  è£œå®Œæ¸ˆã¿: {missing_before - missing_after}å€‹")  # è£œå®Œã—ãŸæ¬ æå€¤æ•°
print("\n")

# =============================================================================
# ã€STEP 5: ç•°å¸¸å€¤ã®æ¤œå‡ºã¨å‡¦ç†ã€‘
# =============================================================================

print("STEP 5: ç•°å¸¸å€¤ã®æ¤œå‡ºã¨å‡¦ç†")
print("-" * 30)

# æ•°å€¤åˆ—ã«å¯¾ã—ã¦ç•°å¸¸å€¤ã‚’æ¤œå‡ºï¼ˆIQRæ³•ã‚’ä½¿ç”¨ï¼‰
for column in numeric_columns:          # æ•°å€¤åˆ—ã‚’é †ç•ªã«å‡¦ç†
    Q1 = df[column].quantile(0.25)      # ç¬¬1å››åˆ†ä½æ•°ï¼ˆ25%ç‚¹ï¼‰
    Q3 = df[column].quantile(0.75)      # ç¬¬3å››åˆ†ä½æ•°ï¼ˆ75%ç‚¹ï¼‰
    IQR = Q3 - Q1                       # å››åˆ†ä½ç¯„å›²ï¼ˆIQRï¼‰ã‚’è¨ˆç®—
    
    # ç•°å¸¸å€¤ã®é–¾å€¤ã‚’è¨ˆç®—
    lower_bound = Q1 - 1.5 * IQR        # ä¸‹é™é–¾å€¤
    upper_bound = Q3 + 1.5 * IQR        # ä¸Šé™é–¾å€¤
    
    # ç•°å¸¸å€¤ã‚’æ¤œå‡º
    outliers = df[(df[column] < lower_bound) | (df[column] > upper_bound)]
    outlier_count = len(outliers)       # ç•°å¸¸å€¤ã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    
    if outlier_count > 0:               # ç•°å¸¸å€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
        print(f"âš ï¸ {column}: {outlier_count}å€‹ã®ç•°å¸¸å€¤ã‚’æ¤œå‡º")
        print(f"   æ­£å¸¸ç¯„å›²: {lower_bound:.2f} ï½ {upper_bound:.2f}")
        
        # ç•°å¸¸å€¤ã‚’ä¸Šä¸‹é™å€¤ã§ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ï¼ˆå¤–ã‚Œå€¤ã‚’é–¾å€¤ã«ç½®ãæ›ãˆï¼‰
        df[column] = df[column].clip(lower=lower_bound, upper=upper_bound)
        print(f"   â†’ é–¾å€¤ã§ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã—ãŸ")
    else:
        print(f"âœ… {column}: ç•°å¸¸å€¤ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ")

print("\n")

# =============================================================================
# ã€STEP 6: Tableauç”¨æœ€é©åŒ–ã€‘
# =============================================================================

print("STEP 6: Tableauç”¨æœ€é©åŒ–")
print("-" * 30)

# æ—¥ä»˜åˆ—ã‹ã‚‰è¿½åŠ ã®æ™‚é–“è»¸åˆ—ã‚’ä½œæˆ
datetime_columns = df.select_dtypes(include=['datetime64[ns]']).columns
for column in datetime_columns:         # æ—¥ä»˜åˆ—ã‚’é †ç•ªã«å‡¦ç†
    base_name = column.replace('_date', '').replace('_time', '')  # ãƒ™ãƒ¼ã‚¹åã‚’ç”Ÿæˆ
    
    # å¹´åˆ—ã‚’ä½œæˆ
    df[f'{base_name}_year'] = df[column].dt.year
    print(f"âœ… {base_name}_year åˆ—ã‚’ä½œæˆ")
    
    # æœˆåˆ—ã‚’ä½œæˆ
    df[f'{base_name}_month'] = df[column].dt.month
    print(f"âœ… {base_name}_month åˆ—ã‚’ä½œæˆ")
    
    # å››åŠæœŸåˆ—ã‚’ä½œæˆ
    df[f'{base_name}_quarter'] = df[column].dt.quarter
    print(f"âœ… {base_name}_quarter åˆ—ã‚’ä½œæˆ")
    
    # æ›œæ—¥åˆ—ã‚’ä½œæˆ
    df[f'{base_name}_weekday'] = df[column].dt.day_name()
    print(f"âœ… {base_name}_weekday åˆ—ã‚’ä½œæˆ")
    
    # æœˆååˆ—ã‚’ä½œæˆ
    df[f'{base_name}_month_name'] = df[column].dt.month_name()
    print(f"âœ… {base_name}_month_name åˆ—ã‚’ä½œæˆ")

# ã‚«ãƒ†ã‚´ãƒªå‹ã¸ã®å¤‰æ›ï¼ˆãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›ï¼‰
for column in df.select_dtypes(include=['object']).columns:  # æ–‡å­—åˆ—å‹ã®åˆ—
    unique_ratio = df[column].nunique() / len(df)  # ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤ã®å‰²åˆã‚’è¨ˆç®—
    if unique_ratio < 0.5:              # ãƒ¦ãƒ‹ãƒ¼ã‚¯å€¤ãŒ50%æœªæº€ã®å ´åˆ
        df[column] = df[column].astype('category')  # ã‚«ãƒ†ã‚´ãƒªå‹ã«å¤‰æ›
        print(f"âœ… {column} ã‚’ã‚«ãƒ†ã‚´ãƒªå‹ã«å¤‰æ›ï¼ˆãƒ¡ãƒ¢ãƒªå‰Šæ¸›ï¼‰")

print("\n")

# =============================================================================
# ã€STEP 7: æœ€çµ‚ç¢ºèªã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‘
# =============================================================================

print("STEP 7: æœ€çµ‚ç¢ºèªã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ")
print("-" * 30)

# æœ€çµ‚çš„ãªãƒ‡ãƒ¼ã‚¿ã®æ¦‚è¦ã‚’è¡¨ç¤º
print("ğŸ‰ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°å®Œäº†ï¼")
print(f"æœ€çµ‚ãƒ‡ãƒ¼ã‚¿å½¢çŠ¶: {df.shape}")      # æœ€çµ‚çš„ãª(è¡Œæ•°, åˆ—æ•°)
print(f"æœ€çµ‚æ¬ æå€¤æ•°: {df.isnull().sum().sum()}")  # æœ€çµ‚çš„ãªæ¬ æå€¤æ•°

# ãƒ‡ãƒ¼ã‚¿å‹ã®åˆ†å¸ƒã‚’è¡¨ç¤º
print("\nãƒ‡ãƒ¼ã‚¿å‹ã®åˆ†å¸ƒ:")
dtype_counts = df.dtypes.value_counts()  # ãƒ‡ãƒ¼ã‚¿å‹ã”ã¨ã®åˆ—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
for dtype, count in dtype_counts.items():  # ãƒ‡ãƒ¼ã‚¿å‹ã¨åˆ—æ•°ã‚’è¡¨ç¤º
    print(f"  {dtype}: {count}åˆ—")

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’è¡¨ç¤º
memory_usage = df.memory_usage(deep=True).sum() / 1024 / 1024  # MBå˜ä½ã«å¤‰æ›
print(f"\nãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: {memory_usage:.2f} MB")

# ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’CSVã§ä¿å­˜
output_filename = 'cleaned_data.csv'    # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å®šç¾©
df.to_csv(output_filename, index=False, encoding='utf-8')  # CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
print(f"\nğŸ’¾ ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ '{output_filename}' ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ")

# æœ€çµ‚ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­5è¡Œã‚’è¡¨ç¤º
print("\nğŸ“Š æœ€çµ‚ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­5è¡Œ:")
print(df.head())                        # ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª

print("\n" + "=" * 50)
print("ğŸš€ å…¨ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
print("=" * 50)
